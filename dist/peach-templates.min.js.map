{"version":3,"file":"peach-templates.min.js","sources":["../src/index.js"],"sourcesContent":["function reduceProp(last, prop, i, props){\n    return props[i+1] !== void 0\n    ? last[prop]\n    : {last, prop};\n}\n\nfunction formatWith(format, gets, defaults){\n\n    const {last, prop} = gets\n    .split('.')\n    .reduce(reduceProp, format);\n\n    return last[prop] !== void 0\n    ? typeof last[prop] === 'function'\n    ? last[prop]() + ''\n    : last[prop]\n    : defaults[prop] + '';\n}\n\nclass Renderer {\n    constructor(string, format = {}, defaults = {}){\n        this.string = string;\n        this.format = format;\n        this.defaults = defaults;\n        this.complete = false;\n        this.pattern =  /([\\s\\S]+?)(\\\\?%)\\(([\\s\\S]+?)\\)/g;\n        this.lastIndex = 0;\n    }\n    next(){\n        const match = this.pattern.exec(this.string);\n        const [m, pre, leaf, prop] = match || [];\n        if(this.complete) return this._last();\n\n        if(!match){\n            this.complete = true;\n            return this._end();\n        }\n\n        this.lastIndex = this.pattern.lastIndex;\n\n        return leaf === '%'\n        ? this._every(pre, prop)\n        : this._default(m);\n    }\n    _last(){\n        return {done: true};\n    }\n    _end(){\n        return {\n            value: [\n                this.string.slice(this.lastIndex),\n                '',\n                null\n            ],\n            done: false\n        };\n    }\n    _default(s){\n        return {\n            value: [\n                s,\n                '',\n                null\n            ],\n            done: false\n        };\n    }\n    [Symbol.iterator](){\n        return this;\n    }\n}\n\nclass RendererSync extends Renderer {\n    constructor(string, format, defaults){\n        super(string, format, defaults)\n    }\n    _every(pre, prop){\n        return {\n            value: [\n                pre,\n                formatWith(\n                    this.format,\n                    prop,\n                    this.defaults\n                ),\n                prop\n            ],\n            done: false\n        };\n    }\n}\n\nclass RendererAsync extends Renderer {\n    constructor(string, format, defaults){\n        super(string, format, defaults)\n    }\n    _last(){\n        return Promise.resolve(super._last());\n    }\n    _end(){\n        return Promise.resolve(super._end());\n    }\n    _every(pre, prop){\n        return Promise.resolve(\n            formatWith(\n                this.format,\n                prop,\n                this.defaults\n            )\n        ).then(result=>({\n            value: Promise.all([\n                pre,\n                result,\n                prop\n            ]),\n            done: false\n        }));\n    }\n    _default(s){\n        return Promise.resolve(super._default());\n    }\n    [Symbol.asyncIterator](){\n      return this;\n    }\n}\n\nfunction composePresenter(presentFN){\n    return function present(str, format = {}, defaults = {}){\n\n        if(typeof str !== 'string'){\n            throw new TypeError(`The value (${str}) at argument 0 is not a string`);\n        }\n\n        if(typeof format !== 'object'){\n            throw new TypeError(`The value (${format}) at argument 1 is not an object`);\n        }\n\n        if(typeof defaults !== 'object'){\n            throw new TypeError(`The value (${defaults}) at argument 2 is not an object`);\n        }\n\n        return presentFN(str, format, defaults);\n    };\n}\n\nconst present = composePresenter(\n    function(str, format, defaults){\n        return new RendererSync(str, format, defaults);\n    }\n);\n\nconst asyncPresent = composePresenter(\n    function(str, format, defaults){\n        return new RendererAsync(str, format, defaults);\n    }\n);\n\nexport { present, asyncPresent }\n"],"names":["reduceProp","last","prop","i","props","formatWith","format","gets","defaults","split","reduce","Renderer","string","this","complete","pattern","lastIndex","next","match","exec","m","pre","leaf","_last","_every","_default","_end","done","value","slice","s","Symbol","iterator","RendererSync","super","RendererAsync","Promise","resolve","then","result","all","asyncIterator","composePresenter","presentFN","str","TypeError","const","present","asyncPresent"],"mappings":"4CAAA,SAASA,EAAWC,EAAMC,EAAMC,EAAGC,GAC/B,YAAsB,IAAfA,EAAMD,EAAE,GACbF,EAAKC,IACJD,KAAAA,EAAMC,KAAAA,GAGb,SAASG,EAAWC,EAAQC,EAAMC,GAE9B,MAAqBD,EACpBE,MAAM,KACNC,OAAOV,EAAYM,GAFbL,SAAMC,SAIb,YAAsB,IAAfD,EAAKC,GACY,mBAAfD,EAAKC,GACZD,EAAKC,KAAU,GACfD,EAAKC,GACLM,EAASN,GAAQ,GAGvB,IAAMS,EAAS,SACCC,EAAQN,EAAaE,yCACjCK,KAASD,OAASA,EAClBC,KAASP,OAASA,EAClBO,KAASL,SAAWA,EACpBK,KAASC,UAAW,EACpBD,KAASE,QAAW,kCACpBF,KAASG,UAAY,GAEzBL,YAAIM,gBACA,IAAUC,EAAQL,KAAKE,QAAQI,KAAKN,KAAKD,UACRM,MAAtBE,OAAGC,OAAKC,OAAMpB,OACzB,OAAOW,KAAKC,SAAiBD,KAAKU,QAE1BL,GAKRL,KAASG,UAAYH,KAAKE,QAAQC,UAEd,MAATM,EACLT,KAAKW,OAAOH,EAAKnB,GACjBW,KAAKY,SAASL,KARhBP,KAASC,UAAW,EACTD,KAAKa,SASxBf,YAAIY,iBACA,OAAYI,MAAM,IAEtBhB,YAAIe,gBACA,OACIE,OACIf,KAASD,OAAOiB,MAAMhB,KAAKG,WAC3B,GACA,MAEJW,MAAU,IAGlBhB,YAAIc,kBAASK,GACT,OACIF,OACIE,EACA,GACA,MAEJH,MAAU,IAGlBhB,YAAKoB,OAAOC,qBACR,OAAWnB,MAIf,IAAMoB,cAA8B,WACpBrB,EAAQN,EAAQE,GACxB0B,OAAMrB,KAAAD,EAAQN,EAAQE,uFAE1ByB,YAAAT,gBAAOH,EAAKnB,GACR,OACI0B,OACIP,EACAhB,EACIQ,KAAKP,OACLJ,EACAW,KAAKL,UAETN,GAEJyB,MAAM,OAfShB,GAoBrBwB,cAA+B,WACrBvB,EAAQN,EAAQE,GACxB0B,OAAMrB,KAAAD,EAAQN,EAAQE,uFAE1B2B,YAAAZ,iBACI,OAAOa,QAAQC,QAAQH,YAAMX,WAAMV,QAEvCsB,YAAAT,gBACI,OAAOU,QAAQC,QAAQH,YAAMR,UAAKb,QAEtCsB,YAAAX,gBAAOH,EAAKnB,GACR,OAAOkC,QAAQC,QACXhC,EACIQ,KAAKP,OACLJ,EACAW,KAAKL,WAEX8B,KAAK,SAAAC,UACHX,MAAOQ,QAAQI,KACXnB,EACAkB,EACArC,IAEJyB,MAAM,MAGdQ,YAAAV,kBAASK,GACL,OAAOM,QAAQC,QAAQH,YAAMT,cAASZ,QAE1CsB,YAACJ,OAAOU,0BACN,OAAO5B,SA9BeF,GAkC5B,SAAS+B,EAAiBC,GACtB,OAAO,SAAiBC,EAAKtC,EAAaE,GAEtC,yCAAkB,iBAARoC,EACN,MAAM,IAAIC,UAAU,cAAcD,qCAGtC,GAAqB,iBAAXtC,EACN,MAAM,IAAIuC,UAAU,cAAcvC,sCAGtC,GAAuB,iBAAbE,EACN,MAAM,IAAIqC,UAAU,cAAcrC,sCAGtC,OAAOmC,EAAUC,EAAKtC,EAAQE,IAItCsC,IAAMC,EAAUL,EACZ,SAASE,EAAKtC,EAAQE,GAClB,OAAO,IAAIyB,EAAaW,EAAKtC,EAAQE,KAIvCwC,EAAeN,EACjB,SAASE,EAAKtC,EAAQE,GAClB,OAAO,IAAI2B,EAAcS,EAAKtC,EAAQE"}
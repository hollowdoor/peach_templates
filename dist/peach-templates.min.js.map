{"version":3,"file":"peach-templates.min.js","sources":["../src/index.js"],"sourcesContent":["function reduceProp(last, prop, i, props){\n    return props[i+1] !== void 0\n    ? last[prop]\n    : {last, prop};\n}\n\nfunction getLast(last, prop, defaults){\n    return last[prop] !== void 0\n    ? typeof last[prop] === 'function'\n    ? last[prop]() + ''\n    : last[prop]\n    : defaults[prop] + '';\n}\n\nfunction formatWith(format, gets, defaults){\n\n    const {last, prop} = gets\n    .split('.')\n    .reduce(reduceProp, format);\n\n    return getLast(last, prop, defaults);\n}\n\nfunction formatAsyncWith(format, gets, defaults){\n\n    const allGets = gets.split('.');\n\n    return !allGets.length\n    ? Promise.resolve(\n        formatWith(\n            format,\n            prop,\n            defaults\n        )\n    )\n    : allGets.reduce((p, prop, i, props)=>{\n        return p.then(last=>{\n            return props[i+1] !== void 0\n            ? last[prop]\n            : {last, prop};\n        });\n    }, Promise.resolve(format))\n    .then(({last, prop})=>{\n        return getLast(last, prop, defaults);\n    });\n}\n\nclass Renderer {\n    constructor(string, format = {}, defaults = {}){\n        this.string = string;\n        this.format = format;\n        this.defaults = defaults;\n        this.complete = false;\n        this.pattern =  /([\\s\\S]+?)(\\\\?%)\\(([\\s\\S]+?)\\)/g;\n        this.lastIndex = 0;\n    }\n    next(){\n        const match = this.pattern.exec(this.string);\n        const [m, pre, leaf, prop] = match || [];\n        if(this.complete) return this._last();\n\n        if(!match){\n            this.complete = true;\n            return this._end();\n        }\n\n        this.lastIndex = this.pattern.lastIndex;\n\n        return leaf === '%'\n        ? this._every(pre, prop)\n        : this._default(m);\n    }\n    _last(){\n        return {done: true};\n    }\n    _end(){\n        return {\n            value: [\n                this.string.slice(this.lastIndex),\n                '',\n                null\n            ],\n            done: false\n        };\n    }\n    _default(s){\n        return {\n            value: [\n                s,\n                '',\n                null\n            ],\n            done: false\n        };\n    }\n    [Symbol.iterator](){\n        return this;\n    }\n}\n\nclass RendererSync extends Renderer {\n    constructor(string, format, defaults){\n        super(string, format, defaults)\n    }\n    _every(pre, prop){\n        return {\n            value: [\n                pre,\n                formatWith(\n                    this.format,\n                    prop,\n                    this.defaults\n                ),\n                prop\n            ],\n            done: false\n        };\n    }\n}\n\nclass RendererAsync extends Renderer {\n    constructor(string, format, defaults){\n        super(string, format, defaults)\n    }\n    _last(){\n        return Promise.resolve(super._last());\n    }\n    _end(){\n        return Promise.resolve(super._end());\n    }\n    _every(pre, prop){\n        return formatAsyncWith(\n            this.format,\n            prop,\n            this.defaults\n        ).then(result=>{\n            return {\n                value: [pre, result, prop],\n                done: false\n            };\n        });\n    }\n    _default(s){\n        return Promise.resolve(super._default());\n    }\n    [Symbol.asyncIterator](){\n      return this;\n    }\n}\n\nfunction composePresenter(presentFN){\n    return function present(str, format = {}, defaults = {}){\n\n        if(typeof str !== 'string'){\n            throw new TypeError(`The value (${str}) at argument 0 is not a string`);\n        }\n\n        if(typeof format !== 'object'){\n            throw new TypeError(`The value (${format}) at argument 1 is not an object`);\n        }\n\n        if(typeof defaults !== 'object'){\n            throw new TypeError(`The value (${defaults}) at argument 2 is not an object`);\n        }\n\n        return presentFN(str, format, defaults);\n    };\n}\n\nconst present = composePresenter(\n    function(str, format, defaults){\n        return new RendererSync(str, format, defaults);\n    }\n);\n\nconst asyncPresent = composePresenter(\n    function(str, format, defaults){\n        return new RendererAsync(str, format, defaults);\n    }\n);\n\nexport { present, asyncPresent }\n"],"names":["reduceProp","last","prop","i","props","getLast","defaults","formatWith","format","gets","split","reduce","Renderer","string","this","complete","pattern","lastIndex","next","match","exec","m","pre","leaf","_last","_every","_default","_end","done","value","slice","s","Symbol","iterator","RendererSync","super","RendererAsync","Promise","resolve","allGets","length","p","then","ref","result","asyncIterator","composePresenter","presentFN","str","TypeError","const","present","asyncPresent"],"mappings":"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"}
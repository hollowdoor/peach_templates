{"version":3,"file":"peach-templates.js","sources":["../src/index.js"],"sourcesContent":["function reduceProp(last, prop, i, props){\n    return props[i+1] !== void 0\n    ? last[prop]\n    : {last, prop};\n}\n\nfunction formatWith(format, gets, defaults){\n\n    const {last, prop} = gets\n    .split('.')\n    .reduce(reduceProp, format);\n\n    return last[prop] !== void 0\n    ? typeof last[prop] === 'function'\n    ? last[prop]() + ''\n    : last[prop]\n    : defaults[prop] + '';\n}\n\nclass Renderer {\n    constructor(string, format = {}, defaults = {}){\n        this.string = string;\n        this.format = format;\n        this.defaults = defaults;\n        this.complete = false;\n        this.pattern =  /([\\s\\S]+?)(\\\\?%)\\(([\\s\\S]+?)\\)/g;\n        this.lastIndex = 0;\n    }\n    next(){\n        const match = this.pattern.exec(this.string);\n        const [m, pre, leaf, prop] = match || [];\n        if(this.complete) return this._last();\n\n        if(!match){\n            this.complete = true;\n            return this._end();\n        }\n\n        this.lastIndex = this.pattern.lastIndex;\n\n        return leaf === '%'\n        ? this._every(pre, prop)\n        : this._default(m);\n    }\n    _last(){\n        return {done: true};\n    }\n    _end(){\n        return {\n            value: [\n                this.string.slice(this.lastIndex),\n                '',\n                null\n            ],\n            done: false\n        };\n    }\n    _default(s){\n        return {\n            value: [\n                s,\n                '',\n                null\n            ],\n            done: false\n        };\n    }\n    [Symbol.iterator](){\n        return this;\n    }\n}\n\nclass RendererSync extends Renderer {\n    constructor(string, format, defaults){\n        super(string, format, defaults)\n    }\n    _every(pre, prop){\n        return {\n            value: [\n                pre,\n                formatWith(\n                    this.format,\n                    prop,\n                    this.defaults\n                ),\n                prop\n            ],\n            done: false\n        };\n    }\n}\n\nclass RendererAsync extends Renderer {\n    constructor(string, format, defaults){\n        super(string, format, defaults)\n    }\n    _last(){\n        return Promise.resolve(super._last());\n    }\n    _end(){\n        return Promise.resolve(super._end());\n    }\n    _every(pre, prop){\n        return Promise.resolve(\n            formatWith(\n                this.format,\n                prop,\n                this.defaults\n            )\n        ).then(result=>({\n            value: Promise.all([\n                pre,\n                result,\n                prop\n            ]),\n            done: false\n        }));\n    }\n    _default(s){\n        return Promise.resolve(super._default());\n    }\n    [Symbol.asyncIterator](){\n      return this;\n    }\n}\n\nexport function present(str, format, defaults){\n    return new RendererSync(str, format, defaults);\n}\n\nexport function asyncPresent(str, format, defaults){\n    return new RendererAsync(str, format, defaults);\n}\n"],"names":["super"],"mappings":"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"}